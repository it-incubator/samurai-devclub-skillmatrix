# Macro и Micro Tasks в Event Loop

В **Event Loop** JavaScript различает два типа задач: **макрозадачи** и **микрозадачи**. Это различие определяет порядок, в котором выполняются асинхронные операции, такие как `setTimeout`, промисы и другие.

## 1. **Макрозадачи (Macro Tasks)**

**Макрозадачи** — это задачи, которые выполняются после завершения всего синхронного кода и всех микрозадач.

* `setTimeout()`
* `setInterval()`
* События DOM (например, клики, прокрутка)

### Как работает макрозадача:

1. Выполняется синхронный код (Call Stack).
2. Обрабатываются все **микрозадачи** из очереди микрозадач.
3. Из очереди макрозадач берётся одна задача, выполняется её колбэк, и процесс повторяется.

## 2. **Микрозадачи (Micro Tasks)**

**Микрозадачи** — это задачи, которые выполняются **после текущего синхронного кода**, но **до** макрозадач. Микрозадачи имеют более высокий приоритет в Event Loop.

* Промисы (например, `.then()` и `.catch()`)
* `queueMicrotask()`
* `MutationObserver`

### Как работает микрозадача:

1. Сначала выполняется синхронный код.
2. Затем выполняются все микрозадачи, которые находятся в очереди микрозадач.
3. Только после этого берутся макрозадачи.

## Пример кода

```js
console.log('Start');

setTimeout(() => {
  console.log('setTimeout'); // макрозадача
}, 0);

Promise.resolve().then(() => {
  console.log('Promise 1'); // микрозадача
}).then(() => {
  console.log('Promise 2'); // микрозадача
});

console.log('End');
```

### Ожидаемый вывод:

```
Start
End
Promise 1        // микрозадача
Promise 2        // микрозадача
setTimeout       // макрозадача
```

* **Сначала** выполняются синхронные сообщения `Start` и `End`.
* **Затем** выполняются все микрозадачи (`Promise 1` и `Promise 2`), потому что они имеют более высокий приоритет.
* **Наконец**, выполняется макрозадача (`setTimeout`).

## Примечания

* **Микрозадачи** выполняются до того, как Event Loop обработает макрозадачи. Это гарантирует, что все операции, такие как обработка результатов промисов, будут выполнены **до** того, как будет выполнен следующий цикл макрозадач.
* Если в процессе выполнения микрозадач добавляются новые микрозадачи, они будут выполняться **до обработки очередных макрозадач**.